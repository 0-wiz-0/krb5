thisconfigdir=../../..
myfulldir=plugins/authdata/saml_server
mydir=plugins/authdata/saml_server

BUILDTOP=$(REL)..$(S)..$(S)..
KRB5_RUN_ENV = @KRB5_RUN_ENV@
KRB5_CONFIG_SETUP = KRB5_CONFIG=$(SRCTOP)/config-files/krb5.conf ; export KRB5_CONFIG ;
PROG_LIBPATH=-L$(TOPLIBD)
PROG_RPATH=$(KRB5_LIBDIR)
MODULE_INSTALL_DIR = $(KRB5_AD_MODULE_DIR)
DEFS=@DEFS@

LOCALINCLUDES = -I$(srcdir)/../../../include/krb5 -I$(srcdir)/../../kdb/ldap/libkdb_ldap -I$(srcdir)/../../../lib/kdb

LIBBASE=saml_server
LIBMAJOR=1
LIBMINOR=0
SO_EXT=.so
SAML_LIBS = -L/usr/local/lib -lsaml -lxml-security-c -lxmltooling -lxerces-c
SHLIB_EXPDEPS = $(TOPLIBD)/libk5crypto$(SHLIBEXT) \
	$(TOPLIBD)/libkrb5$(SHLIBEXT)
SHLIB_EXPLIBS= $(KRB5_BASE_LIBS) -lkdb_ldap $(KDB5_LIBS) $(SUPPORT_LIB) $(LIBS) @LDAP_LIBS@ $(SAML_LIBS)

SHLIB_DIRS=-L$(TOPLIBD)
SHLIB_RDIRS=$(KRB5_LIBDIR)
STOBJLISTS=OBJS.ST
STLIBOBJS= saml_kdc.o saml_ldap.o saml_util.o saml_trust.o
SRCS=saml_kdc.cpp saml_ldap.cpp saml_util.cpp saml_trust.cpp

all-unix:: all-liblinks saml_sign
install-unix:: install-libs
clean-unix:: clean-libs clean-libobjs

clean::
	$(RM) $(LIBBASE)$(SO_EXT) saml_sign

@libnover_frag@
@libobj_frag@

# XXX for now
CC=$(CXX)
CXXFLAGS=-g -DGCC_HASCLASSVISIBILITY=1 -fvisibility=default

saml_sign.o: saml_sign.cpp

saml_sign: saml_sign.o $(STLIBOBJS)
	$(CC_LINK) -o $@ saml_sign.o $(KRB5_BASE_LIBS) $(SAML_LIBS) saml_util.o saml_trust.o

TEST_PROGS = saml_sign

